
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transform data to onavg space &#8212; tpl-onavg</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimizing the surface template" href="../optimization.html" />
    <link rel="prev" title="(Optional) Compare resampled data" href="forrest_compare_resampled.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">tpl-onavg</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    The onavg (OpenNeuro Average) template
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Use the onavg template
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="how_to_use_w_freesurfer.html">
   Use with FreeSurfer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="how_to_use_w_python.html">
   Use with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="forrest_compare_resampled.html">
   (Optional) Compare resampled data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Transform data to onavg space
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Replication of key analyses
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../optimization.html">
   Optimizing the surface template
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../replication.html">
   Outline of benchmarking analyses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Vertex properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../vertex_properties/inter-vertex_distance.html">
   Inter-vertex distance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../vertex_properties/variation_across_vertices.html">
   Variation in vertex properties across the cortex
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../vertex_properties/vertex_distribution.html">
   Vertex distribution on the cortex
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MVPA performance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mvpa/31_summarize_wholebrain_clf.html">
   Whole-brain classification of movie time points
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mvpa/33_summarize_sl_clf.html">
   Searchlight classification of movie segments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mvpa/41_summarize_sl_rsa.html">
   Inter-subject correlation of representational geometry
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computational time
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mvpa/50_summarize_computational_time.html">
   Benchmarking computational time
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://colab.research.google.com/github/feilong/tpl-onavg/blob/docs/how_to_use/space_travel.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/feilong/tpl-onavg"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/feilong/tpl-onavg/issues/new?title=Issue%20on%20page%20%2Fhow_to_use/space_travel.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/how_to_use/space_travel.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inter-subject-correlation">
   Inter-subject correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vertex-area">
   Vertex area
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-resampling-methods-for-isc">
   Comparing resampling methods for ISC
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-resampling-methods-for-vertex-area">
   Comparing resampling methods for vertex area
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-comparisons">
   Additional comparisons
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Transform data to onavg space</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inter-subject-correlation">
   Inter-subject correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vertex-area">
   Vertex area
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-resampling-methods-for-isc">
   Comparing resampling methods for ISC
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-resampling-methods-for-vertex-area">
   Comparing resampling methods for vertex area
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-comparisons">
   Additional comparisons
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="transform-data-to-onavg-space">
<h1>Transform data to onavg space<a class="headerlink" href="#transform-data-to-onavg-space" title="Permalink to this headline">#</a></h1>
<p>In this Jupyter Notebook we demonstrate how to transform data between other surface template spaces and the <code class="docutils literal notranslate"><span class="pre">onavg</span></code> template space using the <code class="docutils literal notranslate"><span class="pre">neuroboros</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">neuroboros</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="n">zscore</span>
</pre></div>
</div>
</div>
</div>
<p>In the examples below, we will use data in the fsaverage template space with ico64 resolution (<code class="docutils literal notranslate"><span class="pre">fsavg-ico64</span></code>, also known as fsaverage6) and transform it to the <code class="docutils literal notranslate"><span class="pre">onavg</span></code> template space with ico32 resolution (<code class="docutils literal notranslate"><span class="pre">onavg-ico32</span></code>). This process is also called resampling.</p>
<p>The code can be easily modified (by changing the <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">target</span></code> parameters in <code class="docutils literal notranslate"><span class="pre">nb.mapping</span></code>) to transform data from and to other spaces.</p>
<div class="section" id="inter-subject-correlation">
<h2>Inter-subject correlation<a class="headerlink" href="#inter-subject-correlation" title="Permalink to this headline">#</a></h2>
<p>In the first example, the data to be transformed is inter-subject correlation (ISC) of response time series to the movie <em>Forrest Gump</em> (3T fMRI data of the <a class="reference external" href="https://www.studyforrest.org/">StudyForrest</a> dataset).</p>
<p>We compute the correlation between the test subject’s time series and the average of other subjects’ time series for each vertex, to obtain a correlation map per test subject (leave–one-subject-out).
The correlation maps are then averaged across subjects, yielding a single average correlation map.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fsavg-ico64&#39;</span><span class="p">,</span> <span class="s1">&#39;onavg-ico32&#39;</span><span class="p">]:</span>
    <span class="n">cache_fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;isc_</span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s1">.pkl&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_fn</span><span class="p">):</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">Forrest</span><span class="p">()</span>
        <span class="n">sids</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">subjects</span>
        <span class="n">isc_fsavg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span>
            <span class="n">dms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span>
                <span class="n">dset</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="s1">&#39;forrest&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">])</span>
            <span class="n">isc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dms</span><span class="p">):</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">dms</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">zscore</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">zscore</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">isc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">isc_fsavg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">isc</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">nb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_fn</span><span class="p">,</span> <span class="n">isc_fsavg</span><span class="p">)</span>
<span class="n">isc_fsavg</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isc_fsavg-ico64.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">isc_fsavg</span></code> is a list of two NumPy arrays, which are the ISCs for the left and right hemispheres, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">isc_fsavg</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(38073,), (38040,)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xfms1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">nb</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="s1">&#39;fsavg-ico64&#39;</span><span class="p">,</span> <span class="s1">&#39;onavg-ico32&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_sum</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="s1">&#39;lr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">xfms1</span></code> is a list of two sparse matrices, which are the transformations for the left and right hemispheres, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xfms1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">xfm</span> <span class="ow">in</span> <span class="n">xfms1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">xfm</span><span class="p">),</span> <span class="n">xfm</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xfm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
&lt;class &#39;scipy.sparse._csc.csc_matrix&#39;&gt; (38073, 9675) (154778,)
&lt;class &#39;scipy.sparse._csc.csc_matrix&#39;&gt; (38040, 9666) (154354,)
</pre></div>
</div>
</div>
</div>
<p>By applying <code class="docutils literal notranslate"><span class="pre">xfms1</span></code> to <code class="docutils literal notranslate"><span class="pre">isc_fsavg</span></code>, we obtain the transformed data, which are in the <code class="docutils literal notranslate"><span class="pre">onavg-ico32</span></code> space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isc_t1</span> <span class="o">=</span> <span class="p">[</span><span class="n">isc</span> <span class="o">@</span> <span class="n">xfm</span> <span class="k">for</span> <span class="n">isc</span><span class="p">,</span> <span class="n">xfm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">isc_fsavg</span><span class="p">,</span> <span class="n">xfms1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">isc_t1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(9675,), (9666,)]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
<span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">isc_fsavg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ISC (fsavg-ico64)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_ISC_fsavg.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">isc_t1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ISC (transformed w/ &quot;keep_sum=False&quot;)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_ISC_t1.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_ISC_fsavg.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_ISC_t1.png" /></p>
</div>
</div>
</div>
</div>
</div>
<p>The transformed ISCs are very close to those computed directly using data in the <code class="docutils literal notranslate"><span class="pre">onavg-ico32</span></code> space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isc_onavg</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;isc_onavg-ico32.pkl&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">isc_onavg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">isc_t1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PearsonRResult(statistic=0.9987059747698581, pvalue=0.0)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="vertex-area">
<h2>Vertex area<a class="headerlink" href="#vertex-area" title="Permalink to this headline">#</a></h2>
<p>Mathematically, transforming data between different spaces is a matrix multiplication:</p>
<div class="math notranslate nohighlight">
\[Y = X T\]</div>
<p>If the input data has <span class="math notranslate nohighlight">\(n\)</span> vertices and the output data has <span class="math notranslate nohighlight">\(m\)</span> vertices, <span class="math notranslate nohighlight">\(X\)</span> is a row vector of <span class="math notranslate nohighlight">\(1 \times n\)</span> elements, <span class="math notranslate nohighlight">\(Y\)</span> is a row vector of <span class="math notranslate nohighlight">\(1 \times m\)</span> elements, and <span class="math notranslate nohighlight">\(T\)</span> is an <span class="math notranslate nohighlight">\(n \times m\)</span> matrix.</p>
<p>In other words, each element in <span class="math notranslate nohighlight">\(Y\)</span> is a weighted sum of the elements in <span class="math notranslate nohighlight">\(X\)</span></p>
<div class="math notranslate nohighlight">
\[Y_j = \sum_{i=1}^{n}X_i T_{i,j}\]</div>
<p>By default <code class="docutils literal notranslate"><span class="pre">nb.mapping</span></code> will normalize the columns of <span class="math notranslate nohighlight">\(T\)</span>, so that the sum of each column equals one. That is,</p>
<div class="math notranslate nohighlight">
\[\sum_{i=1}^{n}T_{i,j} = 1, \text{for } j = 1 \ldots m\]</div>
<p>With this, the sum of the weights for the weighted sum equals one, and the scale of <strong>each element</strong> in <span class="math notranslate nohighlight">\(Y\)</span> is comparable to the scale of <strong>each element</strong> in <span class="math notranslate nohighlight">\(X\)</span>.
This is appropriate for resampling statistics, such as the ISC example above.</p>
<p>When resample some quantitative measures, such as cortical area or volume, it is more appropriate to keep the total quantity constant, that is, making the <strong>sum of all elements</strong> in <span class="math notranslate nohighlight">\(Y\)</span> the same as the <strong>sum of all elements</strong> in <span class="math notranslate nohighlight">\(X\)</span>.
To achieve this goal, the rows of <span class="math notranslate nohighlight">\(T\)</span> are normalized to have unit sum instead of the columns.</p>
<p>This can be done by setting the parameter <code class="docutils literal notranslate"><span class="pre">keep_sum=True</span></code> when using <code class="docutils literal notranslate"><span class="pre">nb.mapping</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area_fsavg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">nb</span><span class="o">.</span><span class="n">morphometry</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;fsavg-ico64&#39;</span><span class="p">)[</span><span class="n">nb</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="s1">&#39;fsavg-ico64&#39;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="s1">&#39;lr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xfms2</span> <span class="o">=</span> <span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="s1">&#39;fsavg-ico64&#39;</span><span class="p">,</span> <span class="s1">&#39;onavg-ico32&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_sum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="s1">&#39;lr&#39;</span><span class="p">]</span>
<span class="n">area_t2</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">@</span> <span class="n">xfm</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">xfm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">area_fsavg</span><span class="p">,</span> <span class="n">xfms2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>After resampling with <code class="docutils literal notranslate"><span class="pre">keep_sum=True</span></code>, the average vertex area is approximately 4x as large (due to the change in data resolution), whereas the sum of vertex area is approximately the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="p">[</span><span class="n">area_fsavg</span><span class="p">,</span> <span class="n">area_t2</span><span class="p">]:</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">area</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> vertices, mean = </span><span class="si">{</span><span class="n">area</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> mm^2, &#39;</span>
          <span class="sa">f</span><span class="s1">&#39;sum = </span><span class="si">{</span><span class="n">area</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> mm^2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>76113 vertices, mean = 2.37 mm^2, sum = 1.80e+05 mm^2
19341 vertices, mean = 9.31 mm^2, sum = 1.80e+05 mm^2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparing-resampling-methods-for-isc">
<h2>Comparing resampling methods for ISC<a class="headerlink" href="#comparing-resampling-methods-for-isc" title="Permalink to this headline">#</a></h2>
<p>When resampling statistics, it is necessary to keep the default <code class="docutils literal notranslate"><span class="pre">keep_sum=False</span></code>.
Otherwise, the scale of individual values in resampled data can be very different from that of the original data.</p>
<p>For example, when resampling inter-subject correlation, with <code class="docutils literal notranslate"><span class="pre">keep_sum=True</span></code> the resampled values can be larger than one, which does not make sense, as correlation coefficients should be no larger than one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isc_t2</span> <span class="o">=</span> <span class="p">[</span><span class="n">isc</span> <span class="o">@</span> <span class="n">xfm</span> <span class="k">for</span> <span class="n">isc</span><span class="p">,</span> <span class="n">xfm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">isc_fsavg</span><span class="p">,</span> <span class="n">xfms2</span><span class="p">)]</span>
<span class="n">isc_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">isc_fsavg</span><span class="p">,</span> <span class="n">isc_t1</span><span class="p">,</span> <span class="n">isc_t2</span><span class="p">,</span> <span class="n">isc_onavg</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fsavg-ico64&#39;</span><span class="p">,</span>
          <span class="s1">&#39;mapped to onavg-ico32, &quot;keep_sum=False&quot;&#39;</span><span class="p">,</span>
          <span class="s1">&#39;mapped to onavg-ico32, &quot;keep_sum=True&quot;&#39;</span><span class="p">,</span>
          <span class="s1">&#39;onavg-ico32&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="n">_</span><span class="o">/</span><span class="mf">2.54</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
                        <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
    <span class="n">d</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">isc_data</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s1">max=</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, sum=</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Inter-subject correlation&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/space_travel_hist_ISC.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="../_images/space_travel_hist_ISC.png" /></p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">isc_t2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ISC (transformed w/ &quot;keep_sum=True&quot;)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_ISC_t2.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">isc_onavg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ISC (onavg-ico32)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_ISC_onavg.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_ISC_fsavg.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_ISC_t1.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_ISC_t2.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_ISC_onavg.png" /></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="comparing-resampling-methods-for-vertex-area">
<h2>Comparing resampling methods for vertex area<a class="headerlink" href="#comparing-resampling-methods-for-vertex-area" title="Permalink to this headline">#</a></h2>
<p>When resampling quantitative measures, it is necessary to use <code class="docutils literal notranslate"><span class="pre">keep_sum=True</span></code>.
Otherwise, the total amount of the quantity can be very different from that of the original data.</p>
<p>For example, when resampling vertex area, with <code class="docutils literal notranslate"><span class="pre">keep_sum=False</span></code> the sum of vertex area is much smaller than that of the original data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area_onavg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">nb</span><span class="o">.</span><span class="n">morphometry</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;onavg-ico32&#39;</span><span class="p">)[</span><span class="n">nb</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="s1">&#39;onavg-ico32&#39;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="s1">&#39;lr&#39;</span><span class="p">]</span>
<span class="n">area_t1</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">@</span> <span class="n">xfm</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">xfm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">area_fsavg</span><span class="p">,</span> <span class="n">xfms1</span><span class="p">)]</span>
<span class="n">area_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">area_fsavg</span><span class="p">,</span> <span class="n">area_t1</span><span class="p">,</span> <span class="n">area_t2</span><span class="p">,</span> <span class="n">area_onavg</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="n">_</span><span class="o">/</span><span class="mf">2.54</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
                        <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
    <span class="n">d</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">area_data</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s1">max=</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, sum=</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="p">([</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">][</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.95</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Vertex area (mm$^2$)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;figures/space_travel_hist_area.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="../_images/space_travel_hist_area.png" /></p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kwargs2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">400</span><span class="p">}</span>
<span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">area_fsavg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vertex area (fsavg-ico64)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_area_fsavg.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs2</span><span class="p">)</span>
<span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">area_t1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vertex area (transformed w/ &quot;keep_sum=False&quot;)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_area_t1.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs2</span><span class="p">)</span>
<span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">area_t2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vertex area (transformed w/ &quot;keep_sum=True&quot;)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_area_t2.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs2</span><span class="p">)</span>
<span class="n">nb</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">area_onavg</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Vertex area (onavg-ico32)&#39;</span><span class="p">,</span>
        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;figures/space_travel_area_onavg.png&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="full-width docutils">
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_area_fsavg.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_area_t1.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_area_t2.png" /></p>
</div>
</div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm docutils">
<div class="sd-card-body docutils">
<p class="sd-card-text"><img alt="" src="../_images/space_travel_area_onavg.png" /></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="additional-comparisons">
<h2>Additional comparisons<a class="headerlink" href="#additional-comparisons" title="Permalink to this headline">#</a></h2>
<p>In the previous examples, we show that when the incorrect resampling method is used, the scale of the resampled data is incorrect.</p>
<p>This is not the only problem. Even when the scale is not taken into consideration (e.g., in Pearson correlations), the individual values of the resampled data are also less accurate when the incorrect resampling method is used.</p>
<p>Here are some comparisons using correlations between the actual values obtained in <code class="docutils literal notranslate"><span class="pre">onavg-ico32</span></code> space directly, and the values resampled from <code class="docutils literal notranslate"><span class="pre">fsavg-ico64</span></code> space to <code class="docutils literal notranslate"><span class="pre">onavg-ico32</span></code> space.</p>
<p>The first value was based on the data resampled with <code class="docutils literal notranslate"><span class="pre">keep_sum=False</span></code>, and the second value with <code class="docutils literal notranslate"><span class="pre">keep_sum=True</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">isc_onavg</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">isc_t1</span><span class="p">,</span> <span class="n">isc_t2</span><span class="p">]:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;r = </span><span class="si">{</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r = 0.999
r = 0.877
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">area_onavg</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">area_t1</span><span class="p">,</span> <span class="n">area_t2</span><span class="p">]:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;r = </span><span class="si">{</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r = 0.362
r = 0.967
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./how_to_use"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="forrest_compare_resampled.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">(Optional) Compare resampled data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../optimization.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Optimizing the surface template</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ma Feilong, Guo Jiahui, M. Ida Gobbini, James V. Haxby<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>